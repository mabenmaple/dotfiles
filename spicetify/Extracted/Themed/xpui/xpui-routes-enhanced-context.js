"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[7405],{23186:(e,t,n)=>{n.r(t),n.d(t,{default:()=>De});var a=n(59713),l=n.n(a),r=n(67294),i=n(46458),o=n(52883),c=n(69518),s=n.n(c),u=n(48556),d=n(73305),m=n(20657),g=n(42038),v=n(95661),y=n(35410),p=n(20534),b=n(70369),f=n(55120),h=n(35213),E=n(23232),I=n(35796),R=n(99191),k=n(56802),P=n(30947),x=n(55911),C=n(20246),w=n(43620),O=n(84242),U=n(1496),T=n(42273),A=n(61048),B=n(6479),S=n.n(B),N=n(94967),D=n(11680),F=n(45287);const _=["pageItems"];function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function L(e,t,n,a){const r=a?{}:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);return t.forEach(((e,t)=>{r[n+t]=e})),r}var M=n(48327),z=n(19719),$=n(42781);var Q=n(34813),X=n(46895),Z=n(1848),K=n(35308),G=n(28248),V=n(73785),H=n(4236),J=n(42922),W=n(7073),Y=n(49961),q=n(24078),ee=n(47307),te=n(2144),ne=n(86213),ae=n(27481),le=n(83384),re=n(82760),ie=n(32626),oe=n(85576),ce=n(87257),se=n(57978),ue=n(75016),de=n(26010),me=n(84788),ge=n(63962),ve=n(94184),ye=n.n(ve),pe=n(83692);const be="TRDgmejiOzKjissuLFSx",fe=({onClick:e=(()=>{}),className:t,label:n,ariaLabel:a=n,Icon:l})=>r.createElement(pe.w,{label:n},r.createElement("button",{type:"button","aria-label":a,className:ye()(be,t),onClick:e},r.createElement(l,{iconSize:16}))),he=r.memo((function({uri:e,uid:t,name:n,durationMs:a,artists:l,album:i,isMOGEFRestricted:o,isExplicit:c,isPlayable:u,index:d,playIndex:g=null,imgUrl:v,contextUri:y,usePlayContextItem:p,isEnhanced:b,playContextPageIndex:f,isFirstRecommendation:h,add:E,remove:I,canBeRemovedFromPlaylist:R,showAddedBy:k,addedBy:P}){var x,C,w,O;const{useCurrentAvailability:T}=(0,r.useContext)(de.I),[A,B]=T(e),S=u&&A,{badges:N,hasBadges:D}=(0,me.r)({offlineAvailability:B,isExplicit:c,isMOGEFRestricted:o,isEnhanced:b}),F=d+1,_=l.items.map((e=>({uri:e.uri,name:e.profile.name}))),j=r.createElement(ne.$,{uri:e,uid:t,albumUri:null==i?void 0:i.uri,artists:_,contextUri:y,isRecommendation:b,removePlaylistItems:()=>I([t]),removeRecommendation:()=>I([t]),addRecommendation:()=>E(t),canBeRemovedFromPlaylist:R}),L=(null==_?void 0:_.map((e=>e.name)).join(m.ag.getSeparator()))||"",{isActive:M,isPlaying:z,triggerPlay:$,togglePlay:Q}=p({uid:t,uri:e,index:null!=g?g:d,pageIndex:f}),{spec:X,logger:K}=(0,U.fU)(Z.createDesktopTrackListRowEventFactory,{data:{position:d,reason:"",uri:e}}),G=r.createElement(fe,{onClick:()=>{E(t),K.logInteraction(X.addRecommendationButtonFactory().hitAddToPlaylist({playlist:y,itemToBeAdded:e}))},label:m.ag.get("web-player.enhance.button_label_keep_in_playlist"),Icon:q.G});return r.createElement(J.ZP,{value:"row",index:d},r.createElement(ie._P,{menu:j},r.createElement(re.c,{uri:e,contextUri:y,index:d,onTriggerPlay:()=>{$()},isActive:M,ariaRowIndex:d+1,isPlayable:S,ageRestricted:o,dragMetadata:{name:n,createdBy:L},spec:X,removePlaylistItems:e=>I(e.map((e=>e.id)))},r.createElement(ae.Dd,{ariaColIndex:0},r.createElement(ae.Du,{uri:e,playAriaLabel:m.ag.get("tracklist.a11y.play",n,L),onClick:(e,t)=>{Q({loggingParams:t})},isPlaying:z,isActive:M,spec:X},r.createElement(ae.km,null,F))),r.createElement(ae.vZ,{ariaColIndex:1},r.createElement(ae.lD,{src:v}),r.createElement(ae.vm,null,r.createElement(ae.Wh,{titleText:n},n),D&&r.createElement(ae.g3,null,N.enhanced&&r.createElement(ee._,{iconSize:16,className:le.Z.enhanced,title:m.ag.get("web-player.enhance.button_text_enhanced"),"aria-label":m.ag.get("web-player.enhance.button_text_enhanced")}),N.download&&r.createElement(oe.G,{size:16}),N.explicit&&r.createElement(ce.N,null),N.paid&&r.createElement(ue.g,null),N.nineteen&&r.createElement(se.X,{className:le.Z.nineteen,size:16})),r.createElement(ae.K9,null,r.createElement(ae.T6,{artists:_,spec:X})))),r.createElement(ae.UA,{ariaColIndex:2},r.createElement(ae.BM,{uri:i.uri,name:i.name,creatorUri:null==_||null===(x=_[0])||void 0===x?void 0:x.uri,spec:X},i.name)),k&&r.createElement(ae.UA,{ariaColIndex:3},r.createElement(ae.p_,{name:(null==P?void 0:P.name)||(null==P?void 0:P.id)||"",uri:(null==P?void 0:P.id)&&s().profileURI(P.id).toURI()||"",imageUrl:(null==P||null===(C=P.avatar)||void 0===C?void 0:C.sources)&&(null===(w=(0,Y.X)(null==P||null===(O=P.avatar)||void 0===O?void 0:O.sources,{desiredWidth:24,desiredLabel:"small"}))||void 0===w?void 0:w.url)||"",showAvatar:!0})),r.createElement(ae.mU,{ariaColIndex:3+Number(k)},!!b&&r.createElement(r.Fragment,null,h?r.createElement(ge.T,{id:"enhance-add-recommendation",bodyText:m.ag.get("web-player.enhance.onboarding.add-recommendation-to-playlist"),shouldScrollIntoView:!0},G):G,r.createElement(fe,{onClick:()=>{I([t]),K.logInteraction(X.removeRecommendationButtonFactory().hitRemoveRecommendation({recommendedItemUri:e,contextUri:y}))},label:m.ag.get("web-player.enhance.button_label_remove_from_playlist"),Icon:te.H})),r.createElement(ae.A$,{duration:a}),r.createElement(ae.Zv,{menu:j,label:m.ag.get("more.label.track",n,L),spec:X})))))})),Ee=[V.Q.INDEX,V.Q.TITLE,V.Q.ALBUM,V.Q.DURATION],Ie=[V.Q.INDEX,V.Q.TITLE,V.Q.ALBUM,V.Q.ADDED_BY,V.Q.DURATION],Re=r.memo((function({ariaLabel:e,uri:t,name:n,usePlayContextItem:a,tracklistRef:l,fetchTracks:i,addRecommendation:o,removeItems:c,nrTracks:s,canBeRemovedFromPlaylist:u,showAddedBy:d}){const g=(0,r.useRef)(!1),v=(0,H.k)();(0,r.useEffect)((()=>{var e;g.current&&v&&(null==l||null===(e=l.current)||void 0===e||e.update());g.current=!0}),[v,l]);const y=50,p=(0,r.useRef)((()=>{})),[b,f]=(0,r.useState)([]),{logger:h,spec:E,UBIFragment:I}=(0,U.fU)(X.createDesktopTrackListEventFactory,{data:{uri:t,identifier:"enhanced-tracklist"}}),R=(0,r.useCallback)((()=>{if(l&&l.current){const{firstIndex:e,lastIndex:t}=l.current.getVisibleTrackWindow(),n=t-e;return Math.max(0,e-Math.round((y-n)/2))}return 0}),[l]),k=(0,r.useCallback)((e=>{var n;p.current(),c({itemIds:e.map((({id:e})=>e)),offset:R(),limit:y});const a=new Set(e.map((({id:e})=>e))),r=(null==l||null===(n=l.current)||void 0===n?void 0:n.getRows())||{},i=[];for(const e in r)if(a.has(r[e].uid)){const t={index:Number(e),item:r[e]};r[e].isEnhanced&&i.push(t)}if(i.length){let e;e=1===i.length?(0,Z.createDesktopTrackListRowEventFactory)({data:{uri:i[0].item.uri,position:i[0].index,reason:""}}).removeRecommendationButtonFactory().hitRemoveRecommendation({contextUri:t,recommendedItemUri:i[0].item.uri}):E.removeItemsButtonFactory().hitRemoveRecommendations({contextUri:t,numberOfRecommendationsToRemove:i.length}),e&&h.logInteraction(e)}}),[c,R,h,l,t,E]),P=(0,r.useCallback)(((e,t)=>{p.current=t,e.length>1?f(e):k(e)}),[k]),x=(0,r.useCallback)((e=>{o({itemIds:[e],offset:R(),limit:y})}),[o,R]),C=(0,r.useCallback)((e=>{c({itemIds:e,offset:R(),limit:y})}),[c,R]),w=(0,r.useCallback)((function(e,n){var l,i,o;const c=(0,Y.X)(null===(l=e.album.coverArt)||void 0===l?void 0:l.sources,{desiredSize:40,desiredLabel:"small"});return r.createElement(he,{key:e.uid,index:n,playIndex:n,contextUri:t,uri:e.uri,uid:e.uid,isPlayable:e.playability.playable,durationMs:e.duration.totalMilliseconds,name:e.name,artists:e.artists,album:e.album,isExplicit:(null===(i=e.contentRating)||void 0===i?void 0:i.label)===W.KS.Explicit,isMOGEFRestricted:(null===(o=e.contentRating)||void 0===o?void 0:o.label)===W.KS.NineteenPlus,imgUrl:(null==c?void 0:c.url)||"",usePlayContextItem:a,isEnhanced:e.isEnhanced,playContextPageIndex:e.playContextPageIndex,isFirstRecommendation:e.isFirstRecommendationOfPage&&n<y,add:x,remove:C,canBeRemovedFromPlaylist:u,showAddedBy:d,addedBy:e.addedBy})}),[a,t,x,C,u,d]),O=(0,r.useCallback)((e=>e.uri),[]),T=(0,r.useCallback)((e=>e.uid),[]);return r.createElement(I,{spec:E},r.createElement(J.ZP,{value:"playlist-tracklist"},r.createElement(G.Pv,{testID:"playlist-tracklist",key:t,ariaLabel:e,hasHeaderRow:!0,columns:d?Ie:Ee,onRemove:P,renderRow:w,resolveUri:O,resolveUid:T,nrTracks:s,fetchTracks:i,limit:y,outerRef:l})),r.createElement(K.h,{title:m.ag.get("playlist.remove_from_playlist",n),isOpen:b.length>0,tracks:b,onClose:e=>{e.stopPropagation(),f([])},onRemove:k}))}));var ke=n(91281),Pe=n(55914),xe=n(21770),Ce=n(39838),we=n(99450),Oe=n(20452);const Ue="z9JdxJgW3OxYysR2dkal";const Te=function({contextUri:e,title:t,message:n,children:a}){const l=(0,r.useRef)(null),[i,o]=(0,r.useState)(!1),c=(0,r.useCallback)((()=>{var e;o(!1),null===(e=l.current)||void 0===e||e.focus()}),[]),s=(0,r.useCallback)((()=>{o(!0)}),[]),{setIsEnhanced:u}=(0,F.U)(e);return r.createElement(ke.x,{onShow:s,onHide:c,placement:"topStart",overlay:i&&r.createElement(Oe.i,null,r.createElement("div",null,r.createElement(Pe.J,{role:"alertdialog",popoverTitle:t,arrow:"bottomEnd",colorSet:"announcement"},n,r.createElement("div",{className:Ue},r.createElement(xe.oM,{buttonSize:Ce.z.sm,onClick:c},m.ag.get("web-player.enhance.missing-functionality-callout.dismiss")),r.createElement(we.D,{buttonSize:Ce.z.sm,onClick:()=>{c(),u(!1)},colorSet:"invertedLight"},m.ag.get("web-player.enhance.missing-functionality-callout.turn-off-enhance"))))))},function(e){return"function"==typeof e}(a)?r.createElement(r.Fragment,null,a(s)):a)},Ae="A4dupilHPIEDfhXDE0m0",Be="JYAfUd8XXrVwcPbq9QaC";function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const De=r.memo((function({metadata:e,capabilities:t}){var n,a,l;const{uri:c,name:B,images:j,totalLength:X,canPlay:Z,canRemove:K}=e,G=(null==t?void 0:t.canFilter)&&X>0,V=(null==t?void 0:t.canSort)&&X>0,[H]=j,J=(0,w.Z)((null==H?void 0:H.url)||null),W=(0,o.k6)(),Y=(0,i.I0)(),q=(0,k.o)(),ee=(0,r.useRef)(null),{isEnhanced:te,playContext:ne,numTotalItems:ae,numTotalRecs:le,addRecommendation:re,removeItems:ie,fetchTracks:oe,enhancedRevision:ce,shouldUnderlyingContextChangeRefreshView:se,UBIReason:ue,clearCache:de,fetchIndexOfItemId:me}=function(e){var t;const n=(0,D._)(),{isEnhanced:a,iteration:l,setIsEnhanced:i,toggleIsEnhanced:o}=(0,F.U)(e),[c,s]=(0,r.useState)(null),u=(0,r.useRef)(Date.now()),d=(0,r.useCallback)((()=>Date.now()-u.current>3e3),[]),m=(0,r.useRef)({}),g=(0,r.useRef)(null),v=(0,r.useCallback)((async(e,t,a,l,r,i,o)=>{var c,d,v,y;i&&(u.current=Date.now());const p=null===(c=g.current)||void 0===c?void 0:c.enhancedRevision;let b;try{b=await o}catch(i){409===(null==i?void 0:i.status)&&(b=await n.getPage(e,t,a,l,r))}const f=null===(d=b)||void 0===d?void 0:d.enhancePage;if(!f)return[];const{pageItems:h}=f,E=S()(f,_),I=await n.decoratePageItems(h);return p!==(null===(v=g.current)||void 0===v?void 0:v.enhancedRevision)?[]:((null===(y=g.current)||void 0===y?void 0:y.enhancedRevision)!==E.enhancedRevision&&(i=!0),m.current=L(m.current,I,l,i),s(E),g.current=E,I)}),[n]),y=(0,r.useCallback)((async({itemIds:t,offset:a=0,limit:r=1})=>{g.current&&l&&v(e,l,g.current.sessionId,a,r,!0,n.addRecommendation(e,g.current.sessionId,g.current.contextRevision,t,a,r))}),[v,e,n,l]),p=(0,r.useCallback)((async({itemIds:t,offset:a=0,limit:r=1})=>{if(!g.current||!l)return;const i=m.current,o=new Set(t);let c=!1;for(const e in i)if(o.has(i[e].uid)&&i[e].isEnhanced){c=!0;break}v(e,l,g.current.sessionId,a,r,!0,n.removeItems(e,g.current.sessionId,g.current.contextRevision,t,a,r,c))}),[v,e,n,l]),b=(0,r.useMemo)((()=>new N.tL),[]),f=(0,r.useCallback)((async(t,a)=>{var r,i,o;if(!l)return[];const c=Math.min(a,((null===(r=g.current)||void 0===r?void 0:r.numTotalItems)||1/0)-t),s=Array.from({length:c},((e,n)=>m.current[n+t]));return s.every((e=>!!e))&&0!==c?s:v(e,l,null===(i=g.current)||void 0===i?void 0:i.sessionId,t,a,!1,b.create(`${e}:${l}:${null===(o=g.current)||void 0===o?void 0:o.sessionId}:${t}:${a}`,(()=>{var r;return n.getPage(e,l,null===(r=g.current)||void 0===r?void 0:r.sessionId,t,a)})))}),[b,v,e,n,l]),h=(0,r.useMemo)((()=>({uri:e,url:null==c?void 0:c.dspContextUri})),[e,null==c?void 0:c.dspContextUri]),E=(0,r.useCallback)((()=>{m.current={}}),[]),I=(0,r.useCallback)((async t=>{var a,r;if(!l)return-1;const{enhancePage:i}=await n.getPage(e,l,null===(a=g.current)||void 0===a?void 0:a.sessionId,0,n.MAX_PAGE_SIZE);return null!==(r=null==i?void 0:i.pageItems.findIndex((e=>e.itemId===t)))&&void 0!==r?r:-1}),[n,l,e]);return{isEnhanced:a,setIsEnhanced:i,toggleIsEnhanced:o,addRecommendation:y,removeItems:p,playContext:h,numTotalItems:isNaN(Number(null==c?void 0:c.numTotalItems))?void 0:Number(null==c?void 0:c.numTotalItems),numTotalRecs:isNaN(Number(null==c?void 0:c.numTotalRecs))?void 0:Number(null==c?void 0:c.numTotalRecs),fetchTracks:f,clearCache:E,enhancedRevision:null==c?void 0:c.enhancedRevision,shouldUnderlyingContextChangeRefreshView:d,UBIReason:c?`enhanced|${null==c?void 0:c.sessionId}#${null==c||null===(t=c.logging)||void 0===t?void 0:t.correlationId}`:"enhanced|",fetchIndexOfItemId:I}}(c);(0,r.useEffect)((()=>{if(te&&"POP"!==W.action){const e=new URLSearchParams(W.location.search).get("uid");if(!e)return;me(e).then((e=>{var t;-1!==e&&(null===(t=ee.current)||void 0===t||t.scrollToIndex(e))}))}}),[W,W.action,W.location.search,me,te]),(0,r.useEffect)((()=>{var e;ce&&(null===(e=ee.current)||void 0===e||e.update())}),[ce]),(0,r.useEffect)((()=>{var e;se()&&(de(),null===(e=ee.current)||void 0===e||e.update())}),[X,de,se]);const{spec:ge,logger:ve,UBIFragment:ye}=(0,U.fU)(u.createDesktopEnhancedEventFactory,{data:{uri:c,identifier:"enhanced-session",reason:ue}}),pe=(0,r.useMemo)((()=>({header:ge.headerFactory()})),[ge]),{isPlaying:be,isActive:fe,togglePlay:he,usePlayContextItem:Ee}=(0,O.n)(ne,{featureIdentifier:"playlist"}),Ie=(0,r.useCallback)((()=>{let e;he(),e=fe?be?ge.playButtonFactory().hitPause({itemToBePaused:c}):ge.playButtonFactory().hitResume({itemToBeResumed:c}):ge.playButtonFactory().hitPlay({itemToBePlayed:c}),ve.logInteraction(e)}),[he,be,fe,ve,ge,c]),ke=function(e=0){const{data:t}=(0,M.J)(z.n5.getUser,["spotify"]);return(0,r.useMemo)((()=>null!=t&&t.body?{isOwner:!1,tracksAdded:e,user:{uri:t.body.uri,type:$.p.USER,username:t.body.id,displayName:t.body.display_name,images:t.body.images}}:null),[t,e])}(le),Pe=null!==(n=null===(a=e.collaborators)||void 0===a||null===(l=a.items)||void 0===l?void 0:l.concat())&&void 0!==n?n:[];ke&&Pe.splice(T.ms-1,0,ke);const xe={count:Pe.length,items:Pe},Ce=(0,r.useCallback)(((e,t)=>{const n=[...t[R.aN[s().Type.ALBUM]]||[],...t[R.aN[s().Type.TRACK]]||[]];n.length>0&&(Y((0,g.jV)(c,n)),q({targetUri:c,intent:"add",type:"drop"}))}),[Y,q,c]);return r.createElement(r.Suspense,{fallback:null},r.createElement(I.N,{path:"/playlist/:playlistId",pageId:d.W.ENHANCED_SESSION}),r.createElement(ye,{spec:ge},r.createElement(b.$,null,m.ag.get("playlist.page-title",B)),r.createElement(p.Z,{types:[R.aN[s().Type.ALBUM],R.aN[s().Type.TRACK]],onDrop:Ce},r.createElement("section",{role:"presentation",className:Ae,"data-testid":"enhanced-playlist-page"},r.createElement(ye,{spec:pe.header},r.createElement(E.s,{metadata:Ne(Ne({},e),{},{collaborators:xe,duration:null,totalLength:null!=ae?ae:X}),isPlaying:be,togglePlay:Ie,backgroundColor:J}),r.createElement("div",null,r.createElement(P.o,{backgroundColor:J},r.createElement(P.F,null,Z?r.createElement(f.$,{onClick:Ie,isPlaying:be,size:x.qE.lg,uri:c}):null,r.createElement(Q.v,{uri:c}),r.createElement(C.y,{menu:r.createElement(y.X,{uri:c,isEnhanced:te})},r.createElement(v.z,null)),(G||V)&&r.createElement("div",{className:Be},G&&r.createElement(r.Suspense,{fallback:null},r.createElement(Te,{contextUri:c,title:m.ag.get("web-player.enhance.missing-functionality-callout.filtering-playlist-disabled-title"),message:m.ag.get("web-player.enhance.missing-functionality-callout.filtering-playlist-disabled-message")},(e=>r.createElement(A.K,{placeholder:m.ag.get("playlist.search_in_playlist"),onActivate:()=>(e(),!1)})))),V&&r.createElement(Te,{contextUri:c,title:m.ag.get("web-player.enhance.missing-functionality-callout.sorting-playlist-disabled-title"),message:m.ag.get("web-player.enhance.missing-functionality-callout.sorting-playlist-disabled-message")},r.createElement(h.l,{columns:[],disabled:!0}))))))),r.createElement("div",{className:"contentSpacing"},r.createElement(r.Suspense,{fallback:null},r.createElement(Re,{key:c,ariaLabel:B,nrTracks:null!=ae?ae:Math.max(15,X),uri:c,name:B,usePlayContextItem:Ee,tracklistRef:ee,fetchTracks:oe,addRecommendation:re,removeItems:ie,canBeRemovedFromPlaylist:K,showAddedBy:!0})))))))}))},23232:(e,t,n)=>{n.d(t,{s:()=>a.s});var a=n(40786)}}]);
//# sourceMappingURL=xpui-routes-enhanced-context.js.map